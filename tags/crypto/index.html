<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Tag: crypto - Zhen Gu&#039;s Blogs</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Zhen Gu&#039;s Blogs"><meta name="msapplication-TileImage" content="/img/favicon.JPG"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Zhen Gu&#039;s Blogs"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Zhen Gu&#039;s Blogs"><meta property="og:url" content="http://zhengu15.github.io/"><meta property="og:site_name" content="Zhen Gu&#039;s Blogs"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://zhengu15.github.io/img/og_image.png"><meta property="article:author" content="Zhen Gu"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://zhengu15.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://zhengu15.github.io"},"headline":"Zhen Gu's Blogs","image":["http://zhengu15.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Zhen Gu"},"publisher":{"@type":"Organization","name":"Zhen Gu's Blogs","logo":{"@type":"ImageObject","url":"http://zhengu15.github.io/img/logo.JPG"}},"description":""}</script><link rel="icon" href="/img/favicon.JPG"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.JPG" alt="Zhen Gu&#039;s Blogs" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit Homepage" href="https://github.com/zhengu15"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags/">Tags</a></li><li class="is-active"><a href="#" aria-current="page">crypto</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2025-04-17T16:00:00.000Z" title="2025/4/18 00:00:00">2025-04-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-04-17T15:33:33.471Z" title="2025/4/17 23:33:33">2025-04-17</time></span><span class="level-item"><a class="link-muted" href="/categories/tech-blogs/">tech blogs</a></span><span class="level-item">6 minutes read (About 860 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/04/18/fhe-intro-2/">FHE Made Simple - 2</a></p><div class="content"><h1 id="Bootstrapping-TFHE-FHEW"><a href="#Bootstrapping-TFHE-FHEW" class="headerlink" title="Bootstrapping (TFHE&#x2F;FHEW)"></a>Bootstrapping (TFHE&#x2F;FHEW)</h1><p>Since boothstrapping for CKKS&#x2F;BFV&#x2F;BGV is highly associated with the algebraic structure of RLWE ciphertexts, before we dig into the mathematical background of the so-called “double-CRT” structure, we only discuss the bootstrapping for TFHE&#x2F;FHEW.</p>
<h2 id="LWE-Decryption"><a href="#LWE-Decryption" class="headerlink" title="LWE Decryption"></a>LWE Decryption</h2><p>A LWE cipehrtext encrypts scalar \(\mu\) with a vector \(\vec{a}\) and a scalar \(b\) under key \(\vec{s}\):<br>$$b&#x3D;\vec{a}\cdot\vec{s}+\mu+e$$<br>The decryption of the LWE ciphertext \(\textrm{LWE}_{\vec{s}}(\mu)&#x3D;(\vec{a},b)\) is then<br>$$\phi(\textrm{LWE}_{\vec{s}}(\mu))&#x3D;b-\vec{a}\cdot\vec{s}&#x3D;b-\sum_ia_is_i$$</p>
<p>For \(a,s,e\) are elements of some proper ring, a RLWE ciphertext encrypting \(\mu\) is<br>$$\textrm{RLWE}_s(\mu)&#x3D;(a,as+\mu+e)$$</p>
<h2 id="Homomorphic-LWE-Decryption"><a href="#Homomorphic-LWE-Decryption" class="headerlink" title="Homomorphic LWE Decryption"></a>Homomorphic LWE Decryption</h2><p>Bootstrapping in FHE is a procedure of homomorphic decryption for ciphertexts. We will learn about how to extract LWE ciphertexts from RLWE. Hence, in this blog we omit the details of \(\textrm{RLWE}_{s^\prime}(\mu)\mapsto\textrm{LWE}_{\vec{s}}(\mu_0)\) and the boostrapping in this blog contains only the procedure of \(\textrm{LWE}_{\vec{s}}(\mu)\mapsto\textrm{RLWE}_{s^\prime}(X^{\mu})\).</p>
<p>$$\begin{align*}&amp;\textrm{RLWE}_{s^\prime}(X^\mu)\\&#x3D;&amp;\textrm{RLWE}_{s^\prime}(X^{b-\sum_ia_is_i})\\&#x3D;&amp;X^b\cdot\textrm{RLWE}_{s^\prime}(\prod_iX^{-a_is_i})\end{align*}$$</p>
<p>In TFHE, we have \(s_i\in{0,1}\). Then<br>$$X^{-a_is_i}&#x3D;\begin{cases}1&amp;s_i&#x3D;0\\X^{-a_i}&amp;s_i&#x3D;1\end{cases}&#x3D;(X^{-a_i}-1)s_i+1$$</p>
<p>Then<br>$$\begin{align*}&amp;\textrm{RLWE}_{s^\prime}(X^\mu)\\&#x3D;&amp;X^b\cdot\textrm{RLWE}_{s^\prime}(\prod_iX^{-a_is_i})\\&#x3D;&amp;X^b\cdot\textrm{RLWE}_{s^\prime}(1)\prod_i\left((X^{-a_i}-1)\textrm{RGSW}_{s^\prime}(s_i)+\textrm{RGSW}_{s^\prime}(1)\right)\end{align*}$$<br>The chaining multiplication of RLWE and RGSW is a series of external products introduced in previous blogs, where<br>$$\textrm{RLWE}_s(\mu)\boxdot\textrm{RGSW}_s(m)&#x3D;\textrm{Keyswitch}_{m\to s}(b)+\textrm{Keyswitch}_{-ms\to s}(a)$$<br>Therefore, </p>
<ol>
<li>in step one we get \(\textrm{RLWE}_{s^\prime}(m_0)&#x3D;X^b\cdot\textrm{RLWE}_{s^\prime}(1)\boxdot\left((X^{-a_0}-1)\textrm{RGSW}_{s^\prime}(s_0)+\textrm{RGSW}_{s^\prime}(1)\right)\)</li>
<li>in step two we get \(\textrm{RLWE}_{s^\prime}(m_1)&#x3D;\textrm{RLWE}_{s^\prime}(m_0)\boxdot\left((X^{-a_1}-1)\textrm{RGSW}_{s^\prime}(s_1)+\textrm{RGSW}_{s^\prime}(1)\right)\)</li>
<li>……<br>After all the iterations are executed, we get \(\textrm{RLWE}_{s^\prime}(m_{n-1})&#x3D;\textrm{RLWE}_{s^\prime}(X^{b-\sum_ia_is_i})&#x3D;\textrm{RLWE}_{s^\prime}(X^\mu)\). Since we were starting with the LWE ciphertext \((\vec{a},b)\) with plaintext \(\mu\) and RGSW encrypted key \(\vec{s}\) and ending with a RLWE ciphertext \(\textrm{RLWE}_{s^\prime}(X^\mu)\), the procedure is a boostrapping for the LWE ciphertext.</li>
</ol>
<h2 id="An-Alternative-Form"><a href="#An-Alternative-Form" class="headerlink" title="An Alternative Form"></a>An Alternative Form</h2><p>For \(\textrm{RLWE}_{s^\prime}(m_{i+1})&#x3D;\textrm{RLWE}_{s^\prime}(m_i)\boxdot\left((X^{-a_i}-1)\textrm{RGSW}_{s^\prime}(s_i)+\textrm{RGSW}_{s^\prime}(1)\right)\), it is usually evaluated with an alternative form:<br>$$\textrm{RLWE}_{s^\prime}(m_{i+1})&#x3D;\left(\textrm{RLWE}_{s^\prime}(m_i)(X^{-a_i}-1)\right)\boxdot\textrm{RGSW}_{s^\prime}(s_i)+\textrm{RLWE}_{s^\prime}(m_i)$$</p>
<h1 id="Programmable-Boostrapping-PBS"><a href="#Programmable-Boostrapping-PBS" class="headerlink" title="Programmable Boostrapping (PBS)"></a>Programmable Boostrapping (PBS)</h1><p>Assume that we have a function called “ExtractLWE”, which extracts a LWE ciphertext encrypting the constant coefficient of the plaintext encrypted by a RLWE ciphertext, namely<br>$$\textrm{ExtractLWE}_{s\to \vec{s^\prime}}\left(\textrm{RLWE}_s(\sum_iX^i\mu_i)\right)&#x3D;\textrm{LWE}_{\vec{s^\prime}}(\mu_0)$$</p>
<p>Then consider the following bootstrapping procedure:<br>$$\begin{align*}&amp;\textrm{LWE}_{\vec{s}}(f(\mu))\\&#x3D;&amp;\textrm{ExtractLWE}_{s^\prime\to\vec{s}}\left(\textrm{RLWE}_{s^\prime}(\sum_iX^if(i)\cdot X^{-\mu})\right)\\&#x3D;&amp;\textrm{ExtractLWE}_{s^\prime\to\vec{s}}\left(\textrm{RLWE}_{s^\prime}(\sum_iX^if(i))\cdot X^{-b}\boxdot\prod_i\left((X^{a_i}-1)\textrm{RGSW}_{s^\prime}(s_i)+\textrm{RGSW}_{s^\prime}(1)\right)\right)\\&#x3D;&amp;\textrm{ExtractLWE}_{s^\prime\to\vec{s}}\left((0,\sum_iX^if(i))\cdot X^{-b}\boxdot\prod_i\left((X^{a_i}-1)\textrm{RGSW}_{s^\prime}(s_i)+\textrm{RGSW}_{s^\prime}(1)\right)\right)\end{align*}$$</p>
<p>In this way, we get \(\textrm{LWE}_{\vec{s}}(f(\mu))\) from \(\textrm{LWE}_{\vec{s}}(\mu)\) through bootstrapping, where \(f\) is an arbitrary function that can be encoded into coefficents of plaintext polynomial encrypted by RLWE ciphertexts. </p>
<ul>
<li>Such bootstrapping procedure is called a programmable boostrapping (PBS).</li>
<li>\((0,\sum_iX^if(i))\) is called a test vector of PBS</li>
<li>\(f(\cdot)\) is called a lookup table of PBS</li>
</ul>
<h1 id="Some-Notes"><a href="#Some-Notes" class="headerlink" title="Some Notes"></a>Some Notes</h1><ol>
<li>The ExtractLWE is a bit different from the commonly used one since it is actually composed of two sub-programs: extracting a LWE with dimension equal to the polynomial degree of RLWE and keyswitching the extrated LWE to a LWE with smaller dimension.</li>
<li>We haven’t discussed how to fit elements of LWE ciphertext into the exponent of the plaintext polynomial, which requires a scaling usually.</li>
<li>Padding and noise estimation is a bit complicated. We will discuss those in more serious blogs.</li>
</ol>
<p>Happy diving in the FHE world!</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2025-04-16T16:00:00.000Z" title="2025/4/17 00:00:00">2025-04-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-04-17T10:49:14.949Z" title="2025/4/17 18:49:14">2025-04-17</time></span><span class="level-item"><a class="link-muted" href="/categories/tech-blogs/">tech blogs</a></span><span class="level-item">6 minutes read (About 907 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/04/17/fhe-intro-1/">FHE Made Simple - 1</a></p><div class="content"><p>Put aside all the mathematical details about algebraic transforms like number-theoretic transforms (NTT) and Residue Number System (RNS) for an hour, and you will find FHE quite simple. </p>
<h1 id="RLWE-Ciphertext"><a href="#RLWE-Ciphertext" class="headerlink" title="RLWE Ciphertext"></a>RLWE Ciphertext</h1><p>For \(a,s,e\) are elements of some proper ring, a RLWE ciphertext encrypting \(\mu\) is<br>$$\textrm{RLWE}_s(\mu)&#x3D;(a,as+\mu+e)$$</p>
<h2 id="Homomorphism-of-RLWE"><a href="#Homomorphism-of-RLWE" class="headerlink" title="Homomorphism of RLWE"></a>Homomorphism of RLWE</h2><ul>
<li>Plaintext Addition: \(\textrm{RLWE}_s(\mu)\oplus m &#x3D; (a,as+\mu+e+m)\)</li>
<li>Homomorphic Addition: \(\textrm{RLWE}_s(\mu)+\textrm{RLWE}_s(m) &#x3D; (a+a^\prime,as+\mu+e+a^\prime s+m+e^\prime)\)</li>
<li>Plaintext Multiplication: \(\textrm{RLWE}_s(\mu)\cdot m &#x3D; (am, ams+\mu m+em)\)</li>
</ul>
<h2 id="Homomorphic-Multiplication-And-Keyswitch"><a href="#Homomorphic-Multiplication-And-Keyswitch" class="headerlink" title="Homomorphic Multiplication And Keyswitch"></a>Homomorphic Multiplication And Keyswitch</h2><p>We take a backward method for the deduction of homomorphic multiplication, considering that<br>$$\mu\cdot m\approx (b-as)\cdot(b^\prime-a^\prime s)$$<br>where \(b&#x3D;as+\mu+e,\ b^\prime&#x3D;a^\prime+m+e^\prime\). Also, considering the trivial RLWE ciphertexts, which are<br>$$\begin{align*}(0,b)&#x3D;&amp;\textrm{RLWE}_s(b)\\(a,0)&#x3D;&amp;\textrm{RLWE}_s(-as)\end{align*}$$<br>By applying the above euqations, we have<br>$$\begin{align*}&amp;\textrm{RLWE}_s(\mu\cdot m)\\&#x3D;&amp;\textrm{RLWE}_s((b-as)(b^\prime-a^\prime s))\\&#x3D;&amp;(0,bb^\prime)+\textrm{RLWE}_s(aa^\prime s^2-ab^\prime s-a^\prime bs)\\&#x3D;&amp;(0,bb^\prime)+(ab^\prime+a^\prime b,0)+\textrm{RLWE}_s(aa^\prime s^2)\\&#x3D;&amp;(ab^\prime+a^\prime b,bb^\prime)+aa^\prime\cdot\textrm{RLWE}_s(s^2)\end{align*}$$</p>
<p>The ciphertext encrypting a non-trivial function of the secret key \(s\) is called a keyswitching key, which in this case is \(\textrm{RLWE}_s(s^2)\). Also, we can rewrite the multiplication of a keyswitching key as a procedure called keyswitch:</p>
<p>$$\textrm{Keyswitch}_{s^2\to s}(aa^\prime)&#x3D;aa^\prime\cdot\textrm{RLWE}_s(s^2)$$</p>
<p>Therefore, homomorphic multiplication can then be rewritten as</p>
<p>$$\textrm{RLWE}_s(\mu)\otimes\textrm{RLWE}_s(m)&#x3D;(ab^\prime+a^\prime b,bb^\prime)+\textrm{Keyswitch}_{s^2\to s}(aa^\prime)$$</p>
<h2 id="Noise-Control-And-Decomposition-of-Keyswitching"><a href="#Noise-Control-And-Decomposition-of-Keyswitching" class="headerlink" title="Noise Control And Decomposition of Keyswitching"></a>Noise Control And Decomposition of Keyswitching</h2><p>The term \(e\) in the RLWE ciphertext is usually called noise in a ciphertext. Usually its norm is bounded in fresh ciphertext. As homomorphic operations are performed over the ciphertext, the noise grows accordingly. To avoid decryption failure, the noise should be carefully maintained. In the case of keyswitching,<br>$$\textrm{Keyswitch}_{s^\prime\to s}(a)&#x3D;a\textrm{RLWE}_{s}(s^\prime)$$<br>The noise term in the keyswitching key is amplified by the norm of \(a\), which in most cases can be very large. Therefore, to maintain the noise level, we have to obtain the keyswitching result with multiplication of keyswitching key by low-norm terms.</p>
<p>In FHE, a method called decomposition is introduced for noise maintaince:<br>$$\begin{align*}&amp;\textrm{RLWE}_s(as^\prime)\\&#x3D;&amp;\textrm{RLWE}_s(\sum_ia_ig_is^\prime)\\&#x3D;&amp;\sum_ia_i\textrm{RLWE}_s(g_is^\prime)\end{align*}$$<br>, where \(a&#x3D;\sum_ia_ig_i\) for some fixed \(g_i\) and \(a_i\) is norm-bounded. The set of \(a_i\) is called a decomposition of \(a\) and the set of \(\textrm{RLWE}_s(g_is^\prime)\) is then the keyswitching key under decomposition. The nosie-maintained keyswitching procedure is then<br>$$\textrm{Keyswitch}_{s^\prime\to s}(a)&#x3D;\sum_ia_i\textrm{RLWE}_s(g_is^\prime)$$<br>A simplest decomposition is bit decomposition, where \(g_i&#x3D;2^i\). In bit decomposition based keyswitch, each ciphertext in keyswitching key is multiplied by a bit and summed up together. Thus the magnitude of noise increase becames logarithmic to the norm of \(a\), which is much smaller than before.</p>
<p>In the following blogs, we will introduce rns decomposition and digit decompostion.</p>
<h2 id="External-Product"><a href="#External-Product" class="headerlink" title="External Product"></a>External Product</h2><p>In TFHE&#x2F;FHEW-based schemes, external product is the basic operation to evaluate the homomorphic multiplication without key-dimension expansion (expand \((1,s)\) to \((1,s,s^2)\)) and relinearization. </p>
<p>In fact, we have<br>$$\begin{align*}&amp;\textrm{RLWE}_s(\mu\cdot m)\\&#x3D;&amp;\textrm{RLWE}_s((b-as)m)\\&#x3D;&amp;\textrm{RLWE}_s(bm)+\textrm{RLWE}_s(-ams)\\&#x3D;&amp;\textrm{Keyswitch}_{m\to s}(b)+\textrm{Keyswtich}_{-ms\to s}(a)\end{align*}$$<br>and the combination of keyswitching keys \(\textrm{RLWE}_s(mg_i),\textrm{RLWE}_s(-msg_i)\) is called RGSW. In some sense,<br>$$\textrm{External Product}&#x3D;2\times\textrm{Keyswitch}$$<br>and<br>$$\textrm{RGSW}&#x3D;2\times\textrm{Keyswitching Key}$$</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>In this blog, we introduced how a RLWE cipehrtext is encryped and homomorphic operations related to it. Futhermore, we introduced the homomorphic multiplication and keyswitching procedure. For better noise control, we introduced the decomposition of keyswitching. In the end, we introduced how to compose a external product in TFHE.</p>
<h1 id="A-Simple-Exercise"><a href="#A-Simple-Exercise" class="headerlink" title="A Simple Exercise"></a>A Simple Exercise</h1><p>For a distributive function \(\varphi\), which means<br>$$\begin{align*}\varphi(a\pm b)&#x3D;&amp;\varphi(a)\pm\varphi(b)\\\varphi(a\cdot b)&#x3D;&amp;\varphi(a)\cdot\varphi(b)\end{align*}$$<br>can you deduce how to obtain \(\textrm{RLWE}_s(\varphi(\mu))\) with \(\textrm{RLWE}_s(\mu)\) and some keyswitching key?</p>
<p>A special case of such distributive function is the galois automorphism usually used in FHE:<br>$$\varphi_i(a(X))&#x3D;a(X^{g^i})$$<br>If you can deduce how to obtain \(\textrm{RLWE}_s(\varphi(\mu))\), you may graduate in our mini-lecture “FHE Made Simple”!</p>
<details><summary>Solution</summary>
Obviously, we have
$$\varphi(\mu)\approx\varphi(b-as)=\varphi(b)-\varphi(a)\varphi(s)$$
Note that \(\varphi(e)\) should be bounded otherwise the above approximation will fail.

<p>Then we have<br>$$\textrm{RLWE}_s(\varphi(\mu))&#x3D;\textrm{RLWE}_s(\varphi(b)-\varphi(a)\varphi(s))&#x3D;(0,\varphi(b))-\textrm{Keyswitch}_{\varphi(s)\to s}(\varphi(a))$$<br></edtails></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2025-04-08T16:00:00.000Z" title="2025/4/9 00:00:00">2025-04-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-04-09T17:20:26.901Z" title="2025/4/10 01:20:26">2025-04-10</time></span><span class="level-item"><a class="link-muted" href="/categories/tech-blogs/">tech blogs</a></span><span class="level-item">4 minutes read (About 543 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/04/09/modmul%20designs/">Modular Multiplication Designs</a></p><div class="content"><p>In cryptography, modular multiplication is a fundamental arithmetic unit in calculation. Usually the cryptographic objects are based on data structures over finite fields. Thus, modular arithmetic operations are the atoms of cryptography.</p>
<p>Modular addition&#x2F;substraction is straightforward, but modular multiplication is a bit complicated. Though many literatures have discussed how to evaluate the modular multiplication with plain multiplication for general moduli, for faster modular multiplication, the number-theoretic properties of special moduli like NTT-friendly or low hamming-weight should be further utilized. In this blog, I will introduce some tricks on modular multiplication designs. </p>
<h1 id="A-Tighter-Parameter-selection-Method-for-Barrett-ModMul"><a href="#A-Tighter-Parameter-selection-Method-for-Barrett-ModMul" class="headerlink" title="A Tighter Parameter-selection Method for Barrett ModMul"></a>A Tighter Parameter-selection Method for Barrett ModMul</h1><p>For \(2^{n-1}&lt;q&lt;2^n\), a Barrett modmul can be written as</p>
<p>$$z&#x3D;xy\mod{q}&#x3D;xy-\left\lfloor\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}\right\rfloor\cdot q$$</p>
<p>, where its key trick is to estimate the quotient \(\left\lfloor\frac{xy}{q}\right\rfloor\) with \(\left\lfloor\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}\right\rfloor\) and \(\alpha,\beta\) are variable parameters for better estimation.</p>
<h2 id="The-Classic-Estimation"><a href="#The-Classic-Estimation" class="headerlink" title="The Classic Estimation"></a>The Classic Estimation</h2><p>Assume \(0\leq x,y&lt;2q\) and we want to ensure that the result \(z\) locates in the same region. A classic estimation would be</p>
<p>$$\begin{align*}\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}\leq&amp;\frac{xy}{q}\\\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}&gt;&amp;\frac{\left(\frac{xy}{2^{n+\alpha}}-1\right)\cdot\left(\frac{2^{2n+\alpha+\beta}}{q}-1\right)}{2^{n+\beta}}\\&#x3D;&amp;\frac{xy}{q}-\frac{2^{n+\alpha}}{q}-\frac{xy}{2^{2n+\alpha+\beta}}+\frac{1}{2^{n+\beta}}\\\geq&amp;\left\lfloor\frac{xy}{q}\right\rfloor-\frac{1}{2}-\frac{1}{2}+0&#x3D;\left\lfloor\frac{xy}{q}\right\rfloor-1\end{align*}$$</p>
<p>Therefore, as long as \(\frac{2^{n+\alpha}}{q}\leq\frac{1}{2},\frac{xy}{2^{2n+\alpha+\beta}}\leq\frac{1}{2}\), we have $$\left\lfloor\frac{xy}{q}\right\rfloor\geq\left\lfloor\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}\right\rfloor\geq\left\lfloor\frac{xy}{q}\right\rfloor-1$$<br>and a step further,<br>$$z&#x3D;xy-\left\lfloor\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}\right\rfloor\cdot q\leq xy-(\left\lfloor\frac{xy}{q}\right\rfloor-1)\cdot q&#x3D;(xy\mod{q})+q&lt;2q$$</p>
<p>The parameter selection is then quite straightforward, take \(\alpha\leq-2,\alpha+\beta\geq3\).</p>
<h2 id="A-Tighter-Estimation"><a href="#A-Tighter-Estimation" class="headerlink" title="A Tighter Estimation"></a>A Tighter Estimation</h2><p>The classic estimation simply applies the relation \(x-1&lt;\lfloor x\rfloor\leq x\). We can estimate the quotient with another equivalence rather than the inequality set, which is<br>$$\left\lfloor\frac{x}{m}\right\rfloor&#x3D;\frac{x-[x]_m}{m}$$<br>where \([x]_m&#x3D;x\mod{m}\in[0,m-1]\). Therefore, the approximated quotient can be re-written as<br>$$\begin{align*}\left\lfloor\frac{\left\lfloor\frac{xy}{2^{n+\alpha}}\right\rfloor\cdot\left\lfloor\frac{2^{2n+\alpha+\beta}}{q}\right\rfloor}{2^{n+\beta}}\right\rfloor&#x3D;&amp;\left\lfloor\frac{\frac{xy-[xy]_{2^{n+\alpha}}}{2^{n+\alpha}}\cdot\frac{2^{2n+\alpha+\beta}-[2^{2n+\alpha+\beta}]_q}{q}}{2^{n+\beta}}\right\rfloor\\&#x3D;&amp;\left\lfloor\frac{xy}{q}-\frac{xy[2^{2n+\alpha+\beta}]_q}{2^{2n+\alpha+\beta}q}-\frac{[xy]_{2^{n+\beta}}\cdot(2^{2n+\alpha+\beta}-[2^{2n+\alpha+\beta}]_q)}{2^{2n+\alpha+\beta}q}\right\rfloor\\&#x3D;&amp;\left\lfloor\frac{xy}{q}\right\rfloor+\left\lfloor\frac{[xy]_q}{q}-\frac{xy[2^{2n+\alpha+\beta}]_q}{2^{2n+\alpha+\beta}q}-\frac{[xy]_{2^{n+\beta}}\cdot(2^{2n+\alpha+\beta}-[2^{2n+\alpha+\beta}]_q)}{2^{2n+\alpha+\beta}q}\right\rfloor\\&#x3D;&amp;\left\lfloor\frac{xy}{q}\right\rfloor+\left\lfloor\frac{[xy]_q2^{2n+\alpha+\beta}-xy[2^{2n+\alpha+\beta}]_q-[xy]_{2^{n+\beta}}\cdot(2^{2n+\alpha+\beta}-[2^{2n+\alpha+\beta}]_q)}{2^{2n+\alpha+\beta}q}\right\rfloor\end{align*}$$</p>
<p>Therefore, one need only to satisfy the constraint<br>$$C(\alpha,\beta)&#x3D;\min_{x,y}{\frac{[xy]_q2^{2n+\alpha+\beta}-xy[2^{2n+\alpha+\beta}]_q-[xy]_{2^{n+\beta}}\cdot(2^{2n+\alpha+\beta}-[2^{2n+\alpha+\beta}]_q)}{2^{2n+\alpha+\beta}q}}\geq -1$$</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.JPG" alt="Zhen Gu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Zhen Gu</p><p class="is-size-6 is-block">DaiDai&#039;s Dad</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>CN</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives/"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories/"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags/"><p class="title">4</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zhengu15" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/zhengu15"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/home/"><span class="level-start"><span class="level-item">home</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/tech-blogs/"><span class="level-start"><span class="level-item">tech blogs</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-17T16:00:00.000Z">2025-04-18</time></p><p class="title"><a href="/2025/04/18/fhe-intro-2/">FHE Made Simple - 2</a></p><p class="categories"><a href="/categories/tech-blogs/">tech blogs</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-16T16:00:00.000Z">2025-04-17</time></p><p class="title"><a href="/2025/04/17/fhe-intro-1/">FHE Made Simple - 1</a></p><p class="categories"><a href="/categories/tech-blogs/">tech blogs</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-08T16:00:00.000Z">2025-04-09</time></p><p class="title"><a href="/2025/04/09/modmul%20designs/">Modular Multiplication Designs</a></p><p class="categories"><a href="/categories/tech-blogs/">tech blogs</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-31T16:21:46.030Z">2025-04-01</time></p><p class="title"><a href="/2025/04/01/zhengu/">Zhen Gu</a></p><p class="categories"><a href="/categories/home/">home</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/04/"><span class="level-start"><span class="level-item">April 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/arithmetic/"><span class="tag">arithmetic</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/crypto/"><span class="tag">crypto</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fhe/"><span class="tag">fhe</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hardware/"><span class="tag">hardware</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.JPG" alt="Zhen Gu&#039;s Blogs" height="28"></a><p class="is-size-7"><span>&copy; 2025 Zhen Gu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>